
######################
# Compute Canada Cloud
# g1-8gb-c4-22gb
######################

# repository for GPU drivers
wget -O /tmp/arbutus-cloud-repo_all.deb http://repo.arbutus.cloud.computecanada.ca/pulp/deb/ubuntu22/pool/main/arbutus-cloud-repo_0.1_all.deb
sudo dpkg -i /tmp/arbutus-cloud-repo_all.deb 

# install drivers
sudo apt-get --yes install nvidia-vgpu-kmod nvidia-vgpu-tools nvidia-vgpu-gridd
sudo reboot

lspci -kv
nvidia-smi
sudo apt-get install --yes opencl-headers clinfo ocl-icd-opencl-dev 
clinfo

#####################
# Amazon
# g3s.xlarge
# ubuntu
#####################

sudo apt-get update
sudo apt-get dist-upgrade
sudo reboot

sudo apt-get install -y linux-headers-virtual linux-source linux-image-extra-virtual
sudo reboot

wget -O /tmp/cuda-keyring.deb https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2204/x86_64/cuda-keyring_1.1-1_all.deb
sudo dpkg -i /tmp/cuda-keyring.deb
sudo apt-get update
sudo apt install -y cuda
sudo reboot
nvidia-smi

sudo apt install -y nvidia-opencl-dev clinfo
sudo apt clean
clinfo

###########
# R and packages
##########


# R repositories
sudo add-apt-repository --yes "deb https://cloud.r-project.org/bin/linux/ubuntu $(lsb_release -cs)-cran40/"
wget -qO- https://cloud.r-project.org/bin/linux/ubuntu/marutter_pubkey.asc | sudo tee -a /etc/apt/trusted.gpg.d/cran_ubuntu_key.asc
sudo add-apt-repository --yes ppa:c2d4u.team/c2d4u4.0+

# R
sudo apt-get --yes install r-cran-devtools r-cran-rcppeigen r-cran-bh r-cran-testthat r-cran-knitr r-cran-assertive
sudo apt-get clean

mkdir ~/.R 
echo 'MAKEFLAGS = -j4' > ~/.R/Makevars
R -e 'dir.create(Sys.getenv("R_LIBS_USER"), recursive = TRUE)'

# GPU packages
devtools::install_github("eborgnine/gpuR")
devtools::install_github("ruoyongxu/clrng")
 

